{% extends "layout.html" %} {% block title %}Login{% endblock %} {% block
content %}
<sub-head>
  <link
    rel="stylesheet"
    href="{{ url_for('static', filename='css/auth/login.css') }}"
  />
  <script src="{{ url_for('static', filename='js/common/safe_redirect.js') }}"></script>
</sub-head>

<div class="auth-card">
  <h2>Admin Login</h2>
  <form id="login-form">
    <div class="form-field">
      <label for="api_key">API Key</label>
      <input type="password" id="api_key" name="api_key" required />
    </div>

    <button type="submit">Login</button>
  </form>
  <div id="login-error"></div>
</div>

<script>
  document
    .getElementById("login-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault();

      const apiKey = document.getElementById("api_key").value;
      const resultEl = document.getElementById("login-error");

      const response = await fetch("/api/auth/login.json", {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ api_key: apiKey }),
      });

      const result = await response.json();

      if (result.status === "success") {
        window.location.href = getSafeRedirect();
      } else {
        document.getElementById("login-error").innerText =
          result.message || "Login failed";
      }
    });
</script>
{% endblock %}
